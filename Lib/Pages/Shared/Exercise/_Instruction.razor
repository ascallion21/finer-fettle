@inject DisplayHelper DH
@using Core.Models.Exercise

@{
    var name = Model.User == null 
        ? String.Join(" | ", Model.Instruction.Equipment.Select(e => e.Name))
        : String.Join(" | ", Model.Instruction.Equipment.IntersectBy(Model.User.EquipmentIds, e => e.Id).Select(e => e.Name));
}

<div>
    @if (String.IsNullOrEmpty(Model.Instruction.Link))
    {
        <span>@name</span>
    }
    else 
    {
        <a target="_blank" href="@Model.Instruction.Link">@name</a>
    }
    @if (Model.Instruction.Locations != null && Model.Instruction.Locations.Any())
    {
        <span>&nbsp;(@for (var i = 0; i < Model.Instruction.Locations.Count; i++)
        {
            var instruction = Model.Instruction.Locations[i];
            <a target="_blank" href="@instruction.Link">@instruction.Location.GetSingleDisplayName()</a>
            @if (i < (Model.Instruction.Locations.Count - 1))
            {
                <text><span>,&#32;</span></text>
            }
        })</span>
    }
</div>

@code {
    [Parameter, EditorRequired]
    [SupplyParameterFromQuery]
    public ViewModels.Newsletter.InstructionViewModel Model { get; set; } = null!;
}