@model Web.ViewModels.User.CreateViewModel
@inject IOptions<CaptchaSettings> CaptchaSettings
@using Core.Models.Exercise
@using Lib.ViewModels.User
@using Lib.ViewModels.Newsletter
@using Web.Code.Extensions;
@using Web.Controllers.Index

@{
    ViewData[ViewData_Blank.Title] = "Consistent Fitness";
    ViewData[ViewData_Blank.Description] = "A personalizable workout routine newsletter.";
    ViewData[ViewData_Blank.Canonical] = _siteSettings.Value.WebUri.AbsoluteUri;
}

<div class="row gy-3 mb-3 mt-0 justify-content-between align-items-end">
    <div class="col-auto">
        <h1 class="primary-heading">Consistent fitness starts here</h1>
        <h2 class="secondary-heading">A personalized workout routine delivered to your inbox daily</h2>
    </div>
    <div class="m-0--empty">
        @if (TempData[TempData_User.SuccessMessage] != null)
        {
            <div class="alert alert-success alert-dismissible mb-1" role="alert">
                <span>@TempData[TempData_User.SuccessMessage]</span>
                <button type="button" class="btn-close" data-dismiss=".alert" aria-label="Close"></button>
            </div>
        }
    </div>
</div>

<div class="row">
    <div class="col-12 col-lg-5 col-xl-4">
        <div class="alert alert-secondary">
            @if (Model.WasSubscribed == true)
            {
                <div class="text-success d-flex justify-content-center logo">
                    @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/favicon-black-bg-color-check.svg")))
                </div>

                <h5 class="text-center">Thank you for signing up!</h5>
                <h6 class="text-center mb-3">Get ready! Your first workout is on its way.</h6>
                <p class="text-center">Click <a href="@Url.ActionLink(nameof(UserController.Edit), UserController.Name, new { Model.UserCreateViewModel.Email, Model.UserCreateViewModel.Token })">here</a> to personalize your routine.</p>
            } 
            else if (Model.WasUnsubscribed == true)
            {
                <div class="text-success d-flex justify-content-center logo">
                    @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/favicon-black-bg-color-check.svg")))
                </div>

                <h5 class="text-center">We're sorry to see you go!</h5>
                <h6 class="text-center mb-3">All of your data has been permanently deleted.</h6>
                <p class="text-center mb-3">Please contact us at <a href="mailto:goodbye@@@_siteSettings.Value.Domain">goodbye@@@_siteSettings.Value.Domain</a> and let us know how we can improve.</p>
                <p class="text-center">Click <a href="@Url.ActionLink(nameof(IndexController.Index), IndexController.Name)">here</a> to resubscribe.</p>
            }
            else 
            {
                <div class="mb-4">
                    @if (Model.WasSubscribed == false || Model.WasUnsubscribed == false)
                    {
                        <div class="text-danger d-flex justify-content-center logo">
                            @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/favicon-black-bg-color-check.svg")))
                        </div>
                    }
                    else if (TempData[TempData_User.SuccessMessage] != null)
                    {
                        <div class="text-success d-flex justify-content-center logo">
                            @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/favicon-black-bg-color-check.svg")))
                        </div>
                    }
                    else
                    {
                        <div class="d-flex justify-content-center logo">
                            @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/favicon-current-color.svg")))
                        </div>
                    }

                    @if (Model.WasUnsubscribed == false)
                    {
                        <h5 class="text-center">An unknown error occured.</h5>
                        <h6 class="text-center">Please contact us at <a href="mailto:help@@@_siteSettings.Value.Domain">help@finerfettle.com</a> to have your account deleted.</h6>
                    }
                    else
                    {
                        // If Model.WasSubscribed == false, just show the validation messages in the form. No need to a 'something went wrong' message.
                        <h6 class="text-center">Subscribe to our home workout routine newsletter and take the guesswork out of fitness!</h6>
                    }
                </div>

                <h6 class="mt-4 mb-1">Sign up</h6>
                <form asp-controller="@IndexController.Name" asp-action="@nameof(IndexController.Create)" method="post" class="alert alert-light shadow">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="form-group mb-3">
                        <label asp-for="UserCreateViewModel.Email" class="control-label" aria-describedby="email-help">@Html.DisplayNameFor(_ => Model.UserCreateViewModel.Email)</label>
                        <input asp-for="UserCreateViewModel.Email" class="form-control" />
                        <span asp-validation-for="UserCreateViewModel.Email" class="text-danger word-break--break-word"></span>
                        <div id="email-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserCreateViewModel.Email)</div>
                    </div>
                    <div class="form-group form-check mb-3">
                        <div>
                            <span><label asp-for="UserCreateViewModel.IsNewToFitness" class="control-label">@Html.DisplayNameFor(_ => Model.UserCreateViewModel.IsNewToFitness)</label></span>
                            <input class="form-check-input" asp-for="UserCreateViewModel.IsNewToFitness" aria-describedby="fitness-help" />
                        </div>
                        <span asp-validation-for="UserCreateViewModel.IsNewToFitness" class="text-danger"></span>
                        <div id="fitness-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserCreateViewModel.IsNewToFitness)</div>
                    </div>
                    <div class="form-group form-check mb-3">
                        <div>
                            <span><label asp-for="UserCreateViewModel.AcceptedTerms" class="control-label">I agree to the</label> <a asp-area="" asp-page="/Terms">Terms of Use</a></span>
                            <input class="form-check-input" asp-for="UserCreateViewModel.AcceptedTerms" aria-describedby="terms-help" />
                        </div>
                        <span asp-validation-for="UserCreateViewModel.AcceptedTerms" class="text-danger"></span>
                        <div id="terms-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserCreateViewModel.AcceptedTerms)</div>
                    </div>
                    <div class="form-group mb-3">
                        <div>
                            <div class="form-check-inline">
                                <input checked class="form-check-input" id="IExistNo" name="@Html.NameFor(_ => Model.UserCreateViewModel.IExist)" type="radio" value="false" aria-describedby="bot-help" />
                                <span><label for="IExistNo" class="control-label">I'm a bot</label></span>
                            </div>
                            <div class="form-check-inline">
                                <input class="form-check-input" id="IExistYes" name="@Html.NameFor(_ => Model.UserCreateViewModel.IExist)" type="radio" value="true" aria-describedby="bot-help" />
                                <span><label for="IExistYes" class="control-label">I'm a human</label></span>
                            </div>
                        </div>
                        <span asp-validation-for="UserCreateViewModel.IExist" class="text-danger"></span>
                        <div id="bot-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserCreateViewModel.IExist)</div>
                    </div>
                    <div class="form-group mb-3">
                        <div class="frc-captcha" data-sitekey="@CaptchaSettings.Value.SiteKey"></div>
                    </div>
                    <div class="form-group">
                        <input type="submit" value="Send Me Workouts" class="btn btn-primary btn-caps font-weight--semibold w-100" style="letter-spacing:1px;" aria-describedby="join-help" />
                        <div id="join-help" class="form-text">Update your preferences or unsubscribe at any time.</div>
                    </div>
                </form>

                <details class="mb-1" @(Model.WasSubscribed == false ? "open='open'" : "")>
                    <summary class="mt-4 mb-1 h6">Login</summary>

                    <form asp-controller="@IndexController.Name" asp-action="@nameof(IndexController.Login)" method="post" class="alert alert-light shadow">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <div class="form-group mb-3">
                            <label asp-for="UserLoginViewModel.Email" class="control-label" aria-describedby="email2-help">@Html.DisplayNameFor(_ => Model.UserLoginViewModel.Email)</label>
                            <input asp-for="UserLoginViewModel.Email" class="form-control" />
                            <span asp-validation-for="UserLoginViewModel.Email" class="text-danger word-break--break-word"></span>
                            <div id="email2-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserLoginViewModel.Email)</div>
                        </div>
                        <div class="form-group mb-3">
                            <div>
                                <div class="form-check-inline">
                                    <input checked class="form-check-input" id="IExistNo2" name="@Html.NameFor(_ => Model.UserLoginViewModel.IExist)" type="radio" value="false" aria-describedby="bot2-help" />
                                    <span><label for="IExistNo2" class="control-label">I'm a bot</label></span>
                                </div>
                                <div class="form-check-inline">
                                    <input class="form-check-input" id="IExistYes2" name="@Html.NameFor(_ => Model.UserLoginViewModel.IExist)" type="radio" value="true" aria-describedby="bot2-help" />
                                    <span><label for="IExistYes2" class="control-label">I'm a human</label></span>
                                </div>
                            </div>
                            <span asp-validation-for="UserLoginViewModel.IExist" class="text-danger"></span>
                            <div id="bot2-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserLoginViewModel.IExist)</div>
                        </div>
                        <div class="form-group mb-3">
                            <div class="frc-captcha" data-sitekey="@CaptchaSettings.Value.SiteKey"></div>
                        </div>
                        <div class="form-group">
                            <input type="submit" value="Send Me a Login Link" class="btn btn-outline-primary btn-caps font-weight--semibold w-100" style="letter-spacing:1px;" aria-describedby="join2-help" />
                            <div id="join2-help" class="form-text">You can use this to resend your account confirmation email.</div>
                        </div>
                    </form>
                </details>
            }
        </div>
    </div>

    <aside class="col-auto flex-grow-1 width--min-content">
        <h6 class="mb-1">Demo<span class="font-weight--normal" style="font-size:x-small;">&nbsp;- some features are altered or disabled.</span></h6>

        <div class="alert alert-light p-1 mb-0 shadow">
            <!-- View is used in emails. Remove page styling by rendering it in an iframe -->
            <iframe class="col-12 gx-0 w-100" 
                    style="height:75vh;background:url('@Url.AbsoluteContent($"~/images/loader.svg")') center center no-repeat;"
                    title="Demo - @_siteSettings.Value.Name"
                    onload="this.style.background = null;"
                    src="@Url.ActionLink(nameof(NewsletterController.Newsletter), NewsletterController.Name)"></iframe>
        </div>

        <details class="mb-1 mt-3">
            <summary class="">Features</summary>

            <ul class="mb-0">
                <li>Customizable workout splits, intensity, and rest days.</li>
                <li>Workouts are simplified for users who are new to fitness to build consistency and reduce injury risk.</li>
                <li>Exercises are chosen based on the equipment you have access to — no pullups without a pullup bar or fitness rings.</li>
                <li>Exercises can be ignored — no more unwanted burpees!</li>
                <li>Exercises can be progressed or regressed to provide easier or harder variations and a smooth difficulty curve.</li>
                <li>Exercises can be set to refresh after a day or several months, depending on your preferred exercise variety.</li>
                <li>Keeps track of how much weight you are able to lift with each exercise.</li>
                <li>Keeps track of how often each muscle is being worked, and will adjust workouts to remove muscle imbalances.</li>
                <li>Built-in deload weeks automatically adjust your workout to reduce the strain placed upon your muscles that week.</li>
                <li>Optional health and fitness tips.</li>
                <li>Optional mobility workouts for rest days.</li>
                <li>Optional sports, injury prevention, and rehabilitation exercises.</li>
            </ul>
        </details>
    </aside>
</div>

@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
}
