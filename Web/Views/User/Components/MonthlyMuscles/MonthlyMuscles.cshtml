@model ViewModels.User.MonthlyMusclesViewModel
@using Code.Extensions
@using Models.User
@using Models.Exercise

@{
    const double MinSetsPerWeek = 8d;
    const double MaxSetsPerWeek = 18d;
    var setsPerWeekAlertType = Model.WeeklyMusclesWorkedOverMonthAvg switch
    {
        > MaxSetsPerWeek => "alert-danger",
        < MinSetsPerWeek => "alert-warning",
        _ => "alert-success"
    };
    // Don't need to work as much if the user is aiming to just maintain muscle
    var strengtheningPrefAdjustments = new Dictionary<StrengtheningPreference, double>
    {
        [StrengtheningPreference.Maintain] = 1.5,
        [StrengtheningPreference.Obtain] = 1.25,
        [StrengtheningPreference.Gain] = 1      
    };
    var muscleTargets = new Dictionary<MuscleGroups, Range>
    {
        [MuscleGroups.Glutes] = 10..25,
        [MuscleGroups.Abdominals] = 10..25,
        [MuscleGroups.Obliques] = 9..21,
        [MuscleGroups.Pectorals] = 9..21,
        [MuscleGroups.Deltoids] = 9..21,
        [MuscleGroups.Hamstrings] = 9..21,
        [MuscleGroups.Quadriceps] = 9..21,
        [MuscleGroups.LatissimusDorsi] = 9..21,
        [MuscleGroups.Trapezius] = 9..21,
        [MuscleGroups.Rhomboids] = 8..19,
        [MuscleGroups.ErectorSpinae] = 8..19,
        [MuscleGroups.Forearms] = 7..17,
        [MuscleGroups.Calves] = 7..17,
        [MuscleGroups.HipFlexors] = 7..17,
        [MuscleGroups.HipAdductors] = 7..17,
        [MuscleGroups.Biceps] = 6..15,
        [MuscleGroups.Triceps] = 6..15,
        [MuscleGroups.SerratusAnterior] = 6..15,
        [MuscleGroups.RotatorCuffs] = 6..15
    };
}

<div class="alert @setsPerWeekAlertType" role="alert">
    <div>You are working ~@Model.WeeklyMusclesWorkedOverMonthAvg.ToString("F0") sets of each muscle group per week.</div>
    <div style="margin-top:1rem;"><small>Aim for between @MinSetsPerWeek and @MaxSetsPerWeek sets per week. Too many sets per week can lead to joint pain and overuse injuries. Too few sets per week may not result in any noticeable strength gain. Beginner lifters are should skew towards the lower end of the range.</small></div>
</div>

@if (Model.User.Email.EndsWith("finerfettle.com") || Model.User.Email.EndsWith("tscanlon.com"))
{
    <div class="alert alert-info" role="alert">
        <h3>Weekly Muscle Targets (beta)</h3>
        @foreach (var muscleGroup in muscleTargets.Keys
            .OrderByDescending(k => muscleTargets[k].Start.Value)
            .ThenByDescending(k => muscleTargets[k].End.Value)
            .ThenBy(k => k.GetSingleDisplayName()))
        {
            var strengtheningPrefAdjustment = strengtheningPrefAdjustments[Model.User.StrengtheningPreference];
            var start = Math.Ceiling(muscleTargets[muscleGroup].Start.Value / strengtheningPrefAdjustment);
            var end = Math.Ceiling(muscleTargets[muscleGroup].End.Value / strengtheningPrefAdjustment);
            var color = Model.WeeklyMusclesWorkedOverMonth[muscleGroup] switch
            {
                int i when i > end => "red",
                int i when i < start => "orange",
                _ => "palegreen",
            };
            var valueInRange = 4 * Model.WeeklyMusclesWorkedOverMonth[muscleGroup];
            <div style="display:flex;justify-content:space-between;column-gap:1rem;">
                <span style="display:flex;">@muscleGroup.GetSingleDisplayName() (@(Model.WeeklyMusclesWorkedOverMonth[muscleGroup]))</span>
                <div style="display:flex;width:50%;align-items:center;">
                    <span style="height:10px;width:100%;border-radius:9in;background:linear-gradient(90deg, @color 0% @valueInRange%, rgba(0,0,0,.1) @valueInRange% 100%)"></span>
                </div>
            </div>
        }
    </div>
}
